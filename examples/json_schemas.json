{
  "_metadata": {
    "description": "JSON schemas for MoMo SMS Data Processing System - Week 2",
    "version": "1.0",
    "created": "2024-09-19",
    "purpose": "API response serialization examples and data mapping documentation"
  },

  "entity_examples": {
    "user": {
      "description": "Individual user entity with basic information",
      "example": {
        "user_id": 1,
        "phone_number": "+250788123456",
        "full_name": "Manzi Arnold",
        "account_status": "active",
        "created_at": "2024-01-15T08:30:00Z"
      }
    },

    "transaction_category": {
      "description": "Transaction type classification entity",
      "example": {
        "category_id": 1,
        "category_name": "Transfer",
        "description": "Person-to-person money transfer",
        "rule_pattern": ".*transfer.*|.*sent.*|.*received.*"
      }
    },

    "raw_message": {
      "description": "Original SMS message data entity",
      "example": {
        "message_id": 1,
        "raw_content": "Wakiriye 5000 RWF uva +250788123456. Umubare mushya: 15000 RWF",
        "parsed_at": "2024-01-15T10:30:00Z",
        "processing_status": "processed"
      }
    },

    "system_log": {
      "description": "ETL processing log entity",
      "example": {
        "log_id": 1,
        "level": "INFO",
        "message": "SMS yasohotse neza",
        "context_json": {
          "message_id": 1,
          "parser_version": "1.0",
          "processing_time_ms": 45
        },
        "transaction_id": 1,
        "created_at": "2024-01-15T10:30:01Z"
      }
    }
  },

  "api_response_examples": {
    "transaction_detail": {
      "description": "Complete transaction with all related data - main API response",
      "example": {
        "transaction_id": 1,
        "amount": 5000.00,
        "currency": "RWF",
        "timestamp": "2024-01-15T10:30:00Z",
        "transaction_type": "receive",
        "status": "completed",
        "reference_number": "TXN001",
        "created_at": "2024-01-15T10:30:00Z",
        "sender": {
          "user_id": 1,
          "phone_number": "+250788123456",
          "full_name": "Manzi Arnold",
          "account_status": "active"
        },
        "receiver": {
          "user_id": 2,
          "phone_number": "+250788234567",
          "full_name": "Kevin Nizeyimana",
          "account_status": "active"
        },
        "category": {
          "category_id": 1,
          "category_name": "Transfer",
          "description": "Person-to-person money transfer"
        },
        "raw_message": {
          "message_id": 1,
          "raw_content": "Wakiriye 5000 RWF uva +250788123456. Umubare mushya: 15000 RWF",
          "processing_status": "processed"
        },
        "processing_logs": [
          {
            "log_id": 1,
            "level": "INFO",
            "message": "SMS yasohotse neza",
            "context_json": {
              "message_id": 1,
              "parser_version": "1.0"
            },
            "created_at": "2024-01-15T10:30:01Z"
          },
          {
            "log_id": 2,
            "level": "INFO",
            "message": "Transaction yashyizwe mu Transfer",
            "context_json": {
              "category_id": 1,
              "confidence": 0.95
            },
            "created_at": "2024-01-15T10:30:02Z"
          }
        ]
      }
    },

    "user_transactions": {
      "description": "User's transaction history with pagination",
      "example": {
        "user_id": 1,
        "user_info": {
          "phone_number": "+250788123456",
          "full_name": "Manzi Arnold",
          "account_status": "active"
        },
        "transactions": [
          {
            "transaction_id": 1,
            "amount": 5000.00,
            "currency": "RWF",
            "timestamp": "2024-01-15T10:30:00Z",
            "transaction_type": "receive",
            "status": "completed",
            "reference_number": "TXN001",
            "category": {
              "category_name": "Transfer",
              "description": "Person-to-person money transfer"
            },
            "counterparty": {
              "phone_number": "+250788234567",
              "full_name": "Kevin Nizeyimana"
            }
          },
          {
            "transaction_id": 4,
            "amount": 3000.00,
            "currency": "RWF",
            "timestamp": "2024-01-15T16:45:00Z",
            "transaction_type": "send",
            "status": "completed",
            "reference_number": "TXN004",
            "category": {
              "category_name": "Transfer",
              "description": "Person-to-person money transfer"
            },
            "counterparty": {
              "phone_number": "+250788567890",
              "full_name": "Karigirwa Ange"
            }
          }
        ],
        "pagination": {
          "current_page": 1,
          "total_pages": 3,
          "total_transactions": 8,
          "per_page": 10
        }
      }
    },

    "analytics_summary": {
      "description": "Aggregated analytics data for dashboard",
      "example": {
        "period": {
          "start_date": "2024-01-15T00:00:00Z",
          "end_date": "2024-01-15T23:59:59Z"
        },
        "summary": {
          "total_transactions": 8,
          "total_volume": 40200.00,
          "average_transaction": 5025.00,
          "success_rate": 100.0
        },
        "by_category": [
          {
            "category_name": "Transfer",
            "transaction_count": 3,
            "total_amount": 15500.00,
            "percentage": 38.6
          },
          {
            "category_name": "Payment",
            "transaction_count": 3,
            "total_amount": 8700.00,
            "percentage": 21.6
          },
          {
            "category_name": "Withdrawal",
            "transaction_count": 1,
            "total_amount": 10000.00,
            "percentage": 24.9
          },
          {
            "category_name": "Airtime",
            "transaction_count": 1,
            "total_amount": 1000.00,
            "percentage": 2.5
          }
        ],
        "by_status": [
          {
            "status": "completed",
            "count": 8,
            "percentage": 100.0
          }
        ],
        "hourly_distribution": [
          {"hour": 10, "count": 1, "amount": 5000.00},
          {"hour": 11, "count": 1, "amount": 2500.00},
          {"hour": 14, "count": 1, "amount": 10000.00},
          {"hour": 16, "count": 1, "amount": 3000.00},
          {"hour": 18, "count": 1, "amount": 1000.00},
          {"hour": 20, "count": 1, "amount": 5000.00}
        ]
      }
    }
  },

  "data_mapping_documentation": {
    "sql_to_json_mapping": {
      "Users": {
        "table_name": "Users",
        "json_property": "user",
        "mapping": {
          "user_id": "user_id",
          "phone_number": "phone_number",
          "full_name": "full_name",
          "account_status": "account_status",
          "created_at": "created_at"
        },
        "notes": "Direct 1:1 mapping for user entity"
      },
      "Transaction_Categories": {
        "table_name": "Transaction_Categories",
        "json_property": "category",
        "mapping": {
          "category_id": "category_id",
          "category_name": "category_name",
          "description": "description",
          "rule_pattern": "rule_pattern (optional in API responses)"
        },
        "notes": "Often embedded in transaction objects"
      },
      "Raw_Messages": {
        "table_name": "Raw_Messages",
        "json_property": "raw_message",
        "mapping": {
          "message_id": "message_id",
          "raw_content": "raw_content",
          "parsed_at": "parsed_at",
          "processing_status": "processing_status"
        },
        "notes": "Included in detailed transaction responses"
      },
      "Transactions": {
        "table_name": "Transactions",
        "json_property": "transaction",
        "mapping": {
          "transaction_id": "transaction_id",
          "amount": "amount",
          "currency": "currency",
          "timestamp": "timestamp",
          "transaction_type": "transaction_type",
          "status": "status",
          "reference_number": "reference_number",
          "created_at": "created_at",
          "sender_id": "sender.user_id (via JOIN)",
          "receiver_id": "receiver.user_id (via JOIN)",
          "category_id": "category.category_id (via JOIN)",
          "message_id": "raw_message.message_id (via JOIN)"
        },
        "notes": "Complex object with nested related entities"
      },
      "System_Logs": {
        "table_name": "System_Logs",
        "json_property": "processing_logs",
        "mapping": {
          "log_id": "log_id",
          "level": "level",
          "message": "message",
          "context_json": "context_json",
          "transaction_id": "transaction_id",
          "created_at": "created_at"
        },
        "notes": "Array of logs associated with transactions"
      }
    },

    "serialization_patterns": {
      "embedded_objects": {
        "description": "Related entities embedded within parent objects",
        "example": "Transaction contains nested User, Category, and Raw_Message objects"
      },
      "referenced_objects": {
        "description": "Related entities referenced by ID with separate API calls",
        "example": "Transaction list contains only category_id, separate call to get category details"
      },
      "flattened_objects": {
        "description": "Related data flattened into single object",
        "example": "User transaction history with counterparty phone/name directly in transaction"
      },
      "aggregated_objects": {
        "description": "Multiple records aggregated into summary objects",
        "example": "Analytics summary with counts, totals, and percentages"
      }
    },

    "api_response_structure": {
      "single_entity": {
        "pattern": "Direct entity mapping",
        "use_case": "GET /users/{id}, GET /transactions/{id}",
        "example": "User object with all fields"
      },
      "entity_with_relations": {
        "pattern": "Entity with nested related objects",
        "use_case": "GET /transactions/{id} (detailed view)",
        "example": "Transaction with sender, receiver, category, raw_message, logs"
      },
      "entity_collection": {
        "pattern": "Array of entities with pagination",
        "use_case": "GET /transactions, GET /users",
        "example": "Transaction list with pagination metadata"
      },
      "aggregated_data": {
        "pattern": "Computed/aggregated data",
        "use_case": "GET /analytics/summary, GET /dashboard",
        "example": "Analytics summary with counts and totals"
      }
    }
  },

  "validation_schemas": {
    "user_schema": {
      "type": "object",
      "required": ["user_id", "phone_number", "account_status"],
      "properties": {
        "user_id": {"type": "integer", "minimum": 1},
        "phone_number": {"type": "string", "pattern": "^\\+[0-9]{10,15}$"},
        "full_name": {"type": "string", "maxLength": 100},
        "account_status": {"type": "string", "enum": ["active", "suspended", "inactive"]},
        "created_at": {"type": "string", "format": "date-time"}
      }
    },
    "transaction_schema": {
      "type": "object",
      "required": ["transaction_id", "amount", "currency", "timestamp", "transaction_type", "status"],
      "properties": {
        "transaction_id": {"type": "integer", "minimum": 1},
        "amount": {"type": "number", "minimum": 0, "multipleOf": 0.01},
        "currency": {"type": "string", "enum": ["RWF", "USD", "EUR", "UGX", "TZS", "KES"]},
        "timestamp": {"type": "string", "format": "date-time"},
        "transaction_type": {"type": "string", "enum": ["send", "receive", "pay", "withdraw", "deposit", "transfer"]},
        "status": {"type": "string", "enum": ["completed", "pending", "failed", "cancelled"]},
        "reference_number": {"type": "string", "maxLength": 50}
      }
    }
  }
}


